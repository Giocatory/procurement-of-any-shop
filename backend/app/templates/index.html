{% extends "base.html" %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - Giocatory Shop{% endblock %}

{% block content %}
<div class="container">
    <div class="hero-section">
        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Giocatory Shop</h1>
        <p>–õ—É—á—à–∏–µ —Ç–æ–≤–∞—Ä—ã –ø–æ –æ—Ç–ª–∏—á–Ω—ã–º —Ü–µ–Ω–∞–º</p>
    </div>

    <div class="main-layout">
        <div class="products-section">
            <div class="filters">
                <select id="category-filter" class="category-filter" onchange="filterByCategory(this.value)">
                    <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    {% for stat in categories_stats %}
                    <option value="{{ stat.category_id }}" 
                            {% if current_category_id == stat.category_id|string %}selected{% endif %}>
                        {{ stat.category_name }} ({{ stat.product_count }})
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div id="products-grid" class="products-grid">
                {% for product in products %}
                <div class="product-card">
                    {% if product.image_url %}
                    <img src="{{ product.image_url }}" 
                         alt="{{ product.name }}" 
                         class="product-image"
                         onerror="this.style.display='none'">
                    {% else %}
                    <div class="no-image-placeholder">
                        <span>üñºÔ∏è</span>
                        <p>No Image</p>
                    </div>
                    {% endif %}
                    <div class="product-info">
                        <h3 class="product-name">{{ product.name }}</h3>
                        <p class="product-description">{{ product.description[:100] }}{% if product.description and product.description|length > 100 %}...{% endif %}</p>
                        <div class="product-meta">
                            <div class="product-price">{{ "%.2f"|format(product.price) }} ‚ÇΩ</div>
                            {% if product.category %}
                            <div class="product-category-badge">{{ product.category.name }}</div>
                            {% endif %}
                        </div>
                        <div class="product-actions">
                            <a href="/product/{{ product.id }}" class="btn btn-primary">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                            <button class="btn btn-secondary" onclick="addToCart({{ product.id }})">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                        </div>
                        {% if not product.in_stock %}
                        <div class="out-of-stock">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</div>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <div class="no-products">
                    <p>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                </div>
                {% endfor %}
            </div>

            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
            {% if pagination.pages > 1 %}
            <div class="pagination">
                {% if pagination.has_prev %}
                <a href="/?page={{ pagination.page - 1 }}{% if current_category_id %}&category_id={{ current_category_id }}{% endif %}" class="page-link">‚Üê –ù–∞–∑–∞–¥</a>
                {% endif %}
                
                {% for page_num in range(1, pagination.pages + 1) %}
                <a href="/?page={{ page_num }}{% if current_category_id %}&category_id={{ current_category_id }}{% endif %}" 
                   class="page-link {% if page_num == pagination.page %}active{% endif %}">
                    {{ page_num }}
                </a>
                {% endfor %}
                
                {% if pagination.has_next %}
                <a href="/?page={{ pagination.page + 1 }}{% if current_category_id %}&category_id={{ current_category_id }}{% endif %}" class="page-link">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- –ë–ª–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
        <div class="categories-sidebar">
            <div class="categories-card">
                <h3 class="categories-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
                <div class="categories-list">
                    {% for stat in categories_stats %}
                    <div class="category-item">
                        <span class="category-name">{{ stat.category_name }}</span>
                        <span class="category-count">{{ stat.product_count }} —Ç–æ–≤–∞—Ä–æ–≤</span>
                    </div>
                    {% else %}
                    <div class="no-categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function filterByCategory(categoryId) {
    if (categoryId) {
        window.location.href = `/?category_id=${categoryId}`;
    } else {
        window.location.href = '/';
    }
}
</script>
{% endblock %}